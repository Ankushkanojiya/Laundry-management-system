<!DOCTYPE html>
<html>
<head>
    <title>Laundry Admin</title>
    <link rel="stylesheet" href="style.css">

</head>
<body>
<h1>Laundry Management System</h1>

<!-- Login Section -->
<div id="login-section" class="form-section">
    <h2>Admin Login</h2>
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button onclick="login()" >Login</button>
    <p id="login-message"></p>
</div>

<!-- Admin Dashboard -->
<div id="admin-dashboard" class="hidden">
    <!-- Navigation Buttons -->
    <div class="nav-buttons">
        <button onclick="showAddCustomer()">Add Customer</button>
        <button onclick="showTakeOrder()">Take Order</button>
        <button onclick="showManageCustomers()">Manage Customers</button>
        <button onclick="showManageOrders()">Show Orders</button>
    </div>

    <!-- Dashboard-->
    <div id="stats-cards" class="dashboard-cards">
        <div class="card pending-card">
            <h3>Pending Orders</h3>
            <p id="pending-count">0</p>
        </div>
        <div class="card revenue-card">
            <h3>Today's Revenue</h3>
            <p id="daily-revenue">â‚¹0</p>
        </div>
    </div>

    <!-- Add Customer Section -->
    <div id="add-customer-section" class="hidden">
        <h2>Add New Customer</h2>
        <div class="form-section">
            <input type="text" id="customer-name" placeholder="Full Name" required>
            <input type="text" id="customer-phone" placeholder="Phone Number (10 digits)" required>
            <button id="add-btn" onclick="addCustomer()">Add Customer</button>
            <p id="action-message"></p>
        </div>
    </div>

    <!-- Take Order Section -->
    <div id="take-order-section" class="hidden">
        <h2>Take New Order</h2>

        <div class="service-type-section">
            <label>Service Type:</label>
            <label>
                <input type="radio" name="serviceType" value="REGULAR" checked>
                ðŸ‘• Regular Wash
            </label>
            <label>
                <input type="radio" name="serviceType" value="LAUNDRY">
                ðŸ§¥ Dry Cleaning
            </label>
        </div>

        <div class="form-section">
            <select id="customer-select">
                <option value="">Select Customer</option>
            </select>
            <input type="number" id="cloth-count" placeholder="Number of Clothes" min="1">
            <button onclick="submitOrder()">Create Order</button>
        </div>
    </div>

    <!-- Manage Customers Section -->
    <div id="manage-customers-section" class="hidden">
        <h2>Customer List</h2>

        <div id="edit-customer-form" class="hidden">
            <h3>Edit Customer</h3>
            <input type="text" id="edit-customer-name" placeholder="Full Name" required>
            <input type="text" id="edit-customer-phone" placeholder="Phone Number" required>
            <button onclick="updateCustomer()">Save Changes</button>
            <button onclick="cancelEdit()">Cancel</button>
            <p id="edit-customer-message"></p>
        </div>
        <div class="form-section">
            <table id="customer-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>


     <!-- Show order section -->
    <div id="manage-order-section" class="hidden">
        <h2>Orders</h2>
        <div class="form-section">
            <table id="orders-table">
                <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Details</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>



<!-- Order Confirmation Popup -->
<div id="order-popup" class="hidden">
    <div class="popup-content">
        <h3>Order Created Successfully! ðŸŽ‰</h3>
        <p><strong>Order ID:</strong> <span id="popup-order-id"></span></p>
        <p><strong>Customer Name:</strong> <span id="popup-customer-name"></span></p>
        <p><strong>Phone Number:</strong> <span id="popup-customer-phone"></span></p>
        <p><strong>Number of Clothes:</strong> <span id="popup-cloth-count"></span></p>
        <p><strong>Total Amount:</strong> â‚¹<span id="popup-total-amount"></span></p>
        <p><strong>Order Date:</strong> <span id="popup-order-date"></span></p>
        <p><strong>Status:</strong> <span id="popup-status">PENDING</span></p>
        <button onclick="closeOrderPopup()">Close</button>
    </div>
</div>

<script>
    <!--  Login  ðŸ”’  -->
    let currentCustomerId = null;
    const BASE_URL = 'http://localhost:8080'; // Update if needed

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        // Check if already logged in (optional)
    });

    // Login function
    async function login() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!username || !password) {
            showMessage('Please enter credentials', 'error', 'login-message');
            return;
        }

        try {
            const response = await fetch(`${BASE_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            if (!response.ok) {
                throw new Error('Login failed - Incorrect username or password ' + response.status);
            }

            // Only execute if login is successful
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('admin-dashboard').classList.remove('hidden');
            hideAllSections(); // Hide all sections initially
            await refreshCustomers(); // Load initial customer data
        } catch (error) {
            showMessage(error.message, 'error', 'login-message');
            console.error('Login error:', error);
        }
    }

 <!--    Add new customer  ðŸ§‘âž•âž•âž•-->
    async function addCustomer() {

         const name = document.getElementById('customer-name').value.trim();
         const phone = document.getElementById('customer-phone').value.trim();
         if (!name || !phone) {
                showMessage('Please fill all fields', 'error');
                return;
         }

         if (!/^\d{10}$/.test(phone)) {
                showMessage('Phone must be 10 digits', 'error');
                return;
            }

         const response = await fetch(`${BASE_URL}/api/customers`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, phoneNumber: phone })
        });

        if (!response.ok) {
            throw new Error('Failed to add customer');
        }

        showMessage('Customer added successfully', 'success');
        resetForm();
        await refreshCustomers();
    }

<!--   Edit customer  âœï¸âœï¸âœï¸-->
    async function editCustomer(id) {
        try {
            showMessage('', 'clear', 'edit-customer-message');
            const response = await fetch(`${BASE_URL}/api/customers/${id}`);
            if (!response.ok) throw new Error('Failed to fetch customer');

            const customer = await response.json();
            document.getElementById('edit-customer-name').value = customer.name;
            document.getElementById('edit-customer-phone').value = customer.phoneNumber;
            currentCustomerId = id;

            document.getElementById('edit-customer-form').classList.remove('hidden');
            document.getElementById('edit-customer-name').value = customer.name;
            document.getElementById('edit-customer-phone').value = customer.phoneNumber;
        } catch (error) {
            showMessage(error.message, 'error');
        }
    }

    <!--   Update customer ðŸ› ï¸ðŸ› ï¸ðŸ› ï¸ðŸ› ï¸ðŸ› ï¸ðŸ› ï¸  -->
    async function updateCustomer() {

        const name= document.getElementById('edit-customer-name').value.trim();
        const phone= document.getElementById('edit-customer-phone').value.trim();
        try{

            const response = await fetch(`${BASE_URL}/api/customers/${currentCustomerId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, phoneNumber: phone })
            });

            if (!response.ok) {
                throw new Error('Failed to update customer');
            }

            // Show success message and hide form after 2 seconds
            showMessage('Customer updated successfully', 'success', 'edit-customer-message');
            setTimeout(() => {
                document.getElementById('edit-customer-form').classList.add('hidden');
                showMessage('', 'clear', 'edit-customer-message');
                refreshCustomers();
            }, 2000);


        }catch (error) {
            showMessage(error.message, 'error', 'edit-customer-message');
        }
    }

<!--  Delete customer  ï¸ðŸ—‘ï¸ðŸ—‘ï¸ðŸ—‘ï¸-->
    async function deleteCustomer(id) {
        if (!confirm('Are you sure you want to delete this customer?')) return;

        try {
            const response = await fetch(`${BASE_URL}/api/customers/${id}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error('Failed to delete customer');
            }

            showMessage('Customer deleted successfully', 'success');
            await refreshCustomers();
        } catch (error) {
            showMessage(error.message, 'error');
        }
    }

<!-- Refresh customer list ðŸ”„ðŸ”„ðŸ”„ðŸ”„-->

    async function refreshCustomers() {
        try {
            const response = await fetch(`${BASE_URL}/api/customers`);
            if (!response.ok) throw new Error('Failed to load customers');

            const customers = await response.json();
            const tableBody = document.querySelector('#customer-table tbody');
            tableBody.innerHTML = customers.map(customer => `
                <tr>
                    <td>${customer.id}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phoneNumber}</td>
                    <td>
                        <button onclick="editCustomer(${customer.id})">Edit</button>
                        <button onclick="deleteCustomer(${customer.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        } catch (error) {
            showMessage(error.message, 'error');
        }
    }

<!-- Cancel Edit âŒâŒâŒ-->
    function cancelEdit() {
        document.getElementById('edit-customer-form').classList.add('hidden');
        currentCustomerId = null;
    }

<!-- Reset form  -->
    function resetForm() {
        document.getElementById('customer-name').value = '';
        document.getElementById('customer-phone').value = '';
    }

<!-- Show status message  -->
    function showMessage(message, type = 'info', elementId = 'action-message') {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.className = type;

        // Auto-clear success messages after 3 seconds
        if (type === 'success') {
            setTimeout(() => {
                element.textContent = '';
                element.className = '';
            }, 3000);
        }
    }

<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-->

<!--    Navigation button to Take order -->
    function showTakeOrder() {
        document.getElementById('order-section').classList.remove('hidden');
        document.getElementById('customer-table').classList.add('hidden');
        loadCustomersForOrder();
    }

<!-- populate the customer in Take order -->
    async function loadCustomersForOrder() {
        try {
            const response = await fetch(`${BASE_URL}/api/customers`);
            const customers = await response.json();
            const select = document.getElementById('customer-select');

            select.innerHTML = '<option value="">Select Customer</option>';
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} (${customer.phoneNumber})`;
                select.appendChild(option);
            });
        } catch (error) {
            showMessage('Failed to load customers', 'error');
        }
    }
    <!-- Submit the order â˜‘ï¸â˜‘ï¸ -->
    async function submitOrder() {
        const customerSelect = document.getElementById('customer-select');
        const clothCountInput = document.getElementById('cloth-count');
        const serviceType= document.querySelector('input[name="serviceType"]:checked').value;

        if (!customerSelect.value || !clothCountInput.value) {
            showMessage('Please select customer and enter cloth count', 'error');
            return;
        }

        try {
            const response = await fetch(`${BASE_URL}/api/orders`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    customerId: parseInt(customerSelect.value),
                    totalClothes: parseInt(clothCountInput.value),
                    serviceType:serviceType
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'Failed to create order');
            }

            const order = await response.json();
            showOrderPopup(order);
            resetOrderForm();
        } catch (error) {
            showMessage(error.message, 'error');
        }
    }
<!-- Receipt ðŸ§¾ðŸ§¾ðŸ§¾-->
    function showOrderPopup(order) {
        document.getElementById('popup-order-id').textContent = order.id;
        document.getElementById('popup-customer-name').textContent = order.customerName;
        document.getElementById('popup-customer-phone').textContent = order.customerPhone;
        document.getElementById('popup-cloth-count').textContent = order.totalClothes;
        document.getElementById('popup-total-amount').textContent = order.totalAmount;
        document.getElementById('popup-order-date').textContent = new Date(order.orderDate).toLocaleDateString();
        document.getElementById('popup-status').textContent = order.status;
        document.getElementById('order-popup').classList.remove('hidden');
    }

    function closeOrderPopup() {
        document.getElementById('order-popup').classList.add('hidden');
    }

    function resetOrderForm() {
        document.getElementById('customer-select').value = '';
        document.getElementById('cloth-count').value = '';
    }



    // Add navigation buttons
    function addNavigationButtons() {
        const nav = document.createElement('div');
        nav.innerHTML = `
            <div class="navigation">
                <button onclick="showCustomerManagement()">Manage Customers</button>
                <button onclick="showTakeOrder()">Take Order</button>
            </div>
        `;
        document.getElementById('admin-dashboard').prepend(nav);
    }

    function showCustomerManagement() {
        document.getElementById('order-section').classList.add('hidden');
        document.getElementById('customer-table').classList.remove('hidden');
    }

    //!@#$%^&*()_)(*&^%$#%^*(*&&&&&&&&&&&&&&&&&&&&########################$@@@@@@@@@@@@@
    //!!@#$%^((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((


    function showAddCustomer() {
        hideAllSections();
        document.getElementById('add-customer-section').classList.remove('hidden');
    }

    function showTakeOrder() {
        hideAllSections();
        document.getElementById('take-order-section').classList.remove('hidden');
        loadCustomersForOrder(); // Load customers in dropdown
    }

    function showManageCustomers() {
        hideAllSections();
        document.getElementById('manage-customers-section').classList.remove('hidden');
        refreshCustomers(); // Refresh customer list
    }

    function hideAllSections() {
        const sections = document.querySelectorAll('#admin-dashboard > div:not(.nav-buttons)');
        sections.forEach(section => section.classList.add('hidden'));
    }

     async function showManageOrders() {
        hideAllSections();
        document.getElementById('manage-order-section').classList.remove('hidden');
        await refreshOrders();
    }

    <!-- All the orders -->
    async function refreshOrders() {
    try {

        const response = await fetch(`${BASE_URL}/api/orders`);
        if (!response.ok) throw new Error('Failed to load orders');

        const orders = await response.json();
        const tbody = document.querySelector('#orders-table tbody');
        tbody.innerHTML = '';

        if (orders.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6" style="text-align:center">No orders found</td></tr>`;
            return;
        }

        orders.forEach(order => {
            // Status button logic
            let statusCell;
            switch(order.status) {
                case 'PENDING':
                    statusCell = `
                        <button class="status-btn pending"
                                onclick="updateStatus(${order.id}, 'IN_PROGRESS')">
                            Start Processing
                        </button>`;
                    break;
                case 'IN_PROGRESS':
                    statusCell = `
                        <button class="status-btn in-progress"
                                onclick="updateStatus(${order.id}, 'COMPLETED')">
                            Mark Complete
                        </button>`;
                    break;
                case 'COMPLETED':
                    statusCell = `<span class="status-badge completed">Completed</span>`;
                    break;
                default:
                    statusCell = order.status;
            }

            // Format order date
            const orderDate = new Date(order.orderDate).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            // Create table row
            tbody.innerHTML += `
                <tr>
                    <td>#${order.id}</td>
                    <td>${order.customerName}</td>
                    <td>${order.totalClothes} items (â‚¹${order.totalAmount})</td>
                    <td>${orderDate}</td>
                    <td class="status-cell">
                        <span class="status-badge ${order.status.toLowerCase()}">
                            ${order.status.replace('_', ' ')}
                        </span>
                    </td>
                    <td class="action-cell">
                        ${statusCell}
                    </td>
                </tr>
            `;
        });

    } catch (error) {
        console.error('Order refresh failed:', error);
        showMessage('Failed to load orders: ' + error.message, 'error');
     }
}

// Status update function
    async function updateStatus(orderId, newStatus) {
        if (!confirm(`Change order status to ${newStatus}?`)) return;

        try {
            const response = await fetch(
                `${BASE_URL}/api/orders/${orderId}/status?newStatus=${newStatus}`,
                { method: 'PATCH' }
            );

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'Status update failed');
            }

            showMessage(`Status updated to ${newStatus}`, 'success');
            await refreshOrders(); // Refresh the list

        } catch (error) {
            showMessage(error.message, 'error');
        }
    }






</script>

</body>
</html>